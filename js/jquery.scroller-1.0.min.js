(function(b){function s(C,x,y){var A=this;var C=C;var x=x;var B;var m;var z;var h=false;this.settings=y;this.values=null;this.val=null;this.temp=null;this.setDefaults=function(D){b.extend(f,D)};this.formatDate=function(M,E,F){if(!E){return null}var N=b.extend({},this.settings,F);var K=function(O){var P=0;while(I+1<M.length&&M.charAt(I+1)==O){P++;I++}return P};var H=function(P,Q,O){var R=""+Q;if(K(P)){while(R.length<O){R="0"+R}}return R};var G=function(O,R,Q,P){return(K(O)?P[R]:Q[R])};var D="";var L=false;for(var I=0;I<M.length;I++){if(L){if(M.charAt(I)=="'"&&!K("'")){L=false}else{D+=M.charAt(I)}}else{switch(M.charAt(I)){case"d":D+=H("d",E.getDate(),2);break;case"D":D+=G("D",E.getDay(),N.dayNamesShort,N.dayNames);break;case"o":D+=H("o",(E.getTime()-new Date(E.getFullYear(),0,0).getTime())/86400000,3);break;case"m":D+=H("m",E.getMonth()+1,2);break;case"M":D+=G("M",E.getMonth(),N.monthNamesShort,N.monthNames);break;case"y":D+=(K("y")?E.getFullYear():(E.getYear()%100<10?"0":"")+E.getYear()%100);break;case"h":var J=E.getHours();D+=H("h",(J>12?(J-12):(J==0?12:J)),2);break;case"H":D+=H("H",E.getHours(),2);break;case"i":D+=H("i",E.getMinutes(),2);break;case"s":D+=H("s",E.getSeconds(),2);break;case"a":D+=E.getHours()>11?"pm":"am";break;case"A":D+=E.getHours()>11?"PM":"AM";break;case"'":if(K("'")){D+="'"}else{L=true}break;default:D+=M.charAt(I)}}}return D};this.parseDate=function(T,M,V){var H=new Date();if(!T||!M){return H}M=(typeof M=="object"?M.toString():M+"");var J=b.extend({},this.settings,V);var E=H.getFullYear();var X=H.getMonth();var R=H.getDate();var G=-1;var U=H.getHours();var N=H.getMinutes();var F=H.getSeconds();var K=0;var Q=false;var L=function(Z){var aa=(D+1<T.length&&T.charAt(D+1)==Z);if(aa){D++}return aa};var Y=function(aa){L(aa);var ab=(aa=="@"?14:(aa=="!"?20:(aa=="y"?4:(aa=="o"?3:2))));var ac=new RegExp("^\\d{1,"+ab+"}");var Z=M.substring(S).match(ac);if(!Z){throw"Missing number at position "+S}S+=Z[0].length;return parseInt(Z[0],10)};var I=function(aa,ac,Z){var ad=(L(aa)?Z:ac);for(var ab=0;ab<ad.length;ab++){if(M.substr(S,ad[ab].length).toLowerCase()==ad[ab].toLowerCase()){S+=ad[ab].length;return ab+1}}throw"Unknown name at position "+S};var P=function(){if(M.charAt(S)!=T.charAt(D)){throw"Unexpected literal at position "+S}S++};var S=0;for(var D=0;D<T.length;D++){if(Q){if(T.charAt(D)=="'"&&!L("'")){Q=false}else{P()}}else{switch(T.charAt(D)){case"d":R=Y("d");break;case"D":I("D",J.dayNamesShort,J.dayNames);break;case"o":G=Y("o");break;case"m":X=Y("m");break;case"M":X=I("M",J.monthNamesShort,J.monthNames);break;case"y":E=Y("y");break;case"H":U=Y("H");break;case"h":U=Y("h");break;case"i":N=Y("i");break;case"s":F=Y("s");break;case"a":K=I("a",["am","pm"],["am","pm"])-1;break;case"A":K=I("A",["am","pm"],["am","pm"])-1;break;case"'":if(L("'")){P()}else{Q=true}break;default:P()}}}if(E<100){E+=new Date().getFullYear()-new Date().getFullYear()%100+(E<=J.shortYearCutoff?0:-100)}if(G>-1){X=1;R=G;do{var O=32-new Date(E,X-1,32).getDate();if(R<=O){break}X++;R-=O}while(true)}if(K&&U<12){U+=12}var W=new Date(E,X-1,R,U,N,F);if(W.getFullYear()!=E||W.getMonth()+1!=X||W.getDate()!=R){throw"Invalid date"}return W};this.setValue=function(E){if(E==undefined){E=true}var D=this.formatResult();this.val=D;this.values=this.temp.slice(0);if(E&&b(C).is("input")){b(C).val(D).change()}};this.getDate=function(){var F=this.values;var E=this.settings;if(E.preset=="date"){return new Date(F[B],F[m],F[z])}if(E.preset=="time"){var D=(E.ampm&&F[E.seconds?3:2]=="PM"&&(F[0]-0)<12)?(F[0]-0+12):F[0];return new Date(1970,0,1,D,F[1],E.seconds?F[2]:null)}if(E.preset=="datetime"){var D=(E.ampm&&F[E.seconds?6:5]=="PM"&&(F[3]-0)<12)?(F[3]-0+12):F[3];return new Date(F[B],F[m],F[z],D,F[4],E.seconds?F[5]:null)}};this.setDate=function(G,E){var F=this.settings;if(F.preset.match(/date/i)){this.temp[B]=G.getFullYear();this.temp[m]=G.getMonth();this.temp[z]=G.getDate()}if(F.preset=="time"){var D=G.getHours();this.temp[0]=(F.ampm)?(D>12?(D-12):(D==0?12:D)):D;this.temp[1]=G.getMinutes();if(F.seconds){this.temp[2]=G.getSeconds()}if(F.ampm){this.temp[F.seconds?3:2]=D>11?"PM":"AM"}}if(F.preset=="datetime"){var D=G.getHours();this.temp[3]=(F.ampm)?(D>12?(D-12):(D==0?12:D)):D;this.temp[4]=G.getMinutes();if(F.seconds){this.temp[2]=G.getSeconds()}if(F.ampm){this.temp[F.seconds?6:5]=D>11?"PM":"AM"}}this.setValue(E)};this.parseValue=function(I){var F=this.settings;if(this.preset){var D=[];if(F.preset=="date"){try{var H=this.parseDate(F.dateFormat,I,F)}catch(G){var H=new Date()}D[B]=H.getFullYear();D[m]=H.getMonth();D[z]=H.getDate()}else{if(F.preset=="time"){try{var H=this.parseDate(F.timeFormat,I,F)}catch(G){var H=new Date()}var E=H.getHours();D[0]=(F.ampm)?(E>12?(E-12):(E==0?12:E)):E;D[1]=H.getMinutes();if(F.seconds){D[2]=H.getSeconds()}if(F.ampm){D[F.seconds?3:2]=E>11?"PM":"AM"}}else{if(F.preset=="datetime"){try{var H=this.parseDate(F.dateFormat+" "+F.timeFormat,I,F)}catch(G){var H=new Date()}var E=H.getHours();D[B]=H.getFullYear();D[m]=H.getMonth();D[z]=H.getDate();D[3]=(F.ampm)?(E>12?(E-12):(E==0?12:E)):E;D[4]=H.getMinutes();if(F.seconds){D[5]=H.getSeconds()}if(F.ampm){D[F.seconds?6:5]=E>11?"PM":"AM"}}}}return D}return F.parseValue(I)};this.formatResult=function(){var E=this.settings;var F=this.temp;if(this.preset){if(E.preset=="date"){return this.formatDate(E.dateFormat,new Date(F[B],F[m],F[z]),E)}else{if(E.preset=="datetime"){var D=(E.ampm)?((F[E.seconds?6:5]=="PM"&&(F[3]-0)<12)?(F[3]-0+12):(F[E.seconds?6:5]=="AM"&&(F[3]==12)?0:F[3])):F[3];return this.formatDate(E.dateFormat+" "+E.timeFormat,new Date(F[B],F[m],F[z],D,F[4],E.seconds?F[5]:null),E)}else{if(E.preset=="time"){var D=(E.ampm)?((F[E.seconds?3:2]=="PM"&&(F[0]-0)<12)?(F[0]-0+12):(F[E.seconds?3:2]=="AM"&&(F[0]==12)?0:F[0])):F[0];return this.formatDate(E.timeFormat,new Date(1970,0,1,D,F[1],E.seconds?F[2]:null),E)}}}}return E.formatResult(F)};this.validate=function(E){var F=this.settings;if(this.preset&&F.preset.match(/date/i)&&((E==B)||(E==m))){var G=32-new Date(this.temp[B],this.temp[m],32).getDate()-1;var D=b("ul:eq("+z+")",x);b("li",D).show();b("li:gt("+G+")",D).hide();if(this.temp[z]>G){if(F.fx){D.animate({top:(r*(n-G-1))+"px"},"fast")}else{D.css({top:(r*(n-G-1))})}this.temp[z]=b("li:eq("+G+")",D).data("val")}}else{t.validate(E)}};this.hide=function(){this.settings.onClose(this.val,this);b(":input:not(.dwtd)").attr("disabled",false).removeClass("dwtd");x.hide();i.hide();h=false;if(this.preset){this.settings.wheels=null}b(window).unbind("resize.dw")};this.show=function(){var K=this.settings;K.beforeShow(C,this);r=K.height;n=Math.round(K.rows/2);a=this;this.init();if(this.preset){K.wheels=new Array();if(K.preset.match(/date/i)){var D={};for(var F=0;F<3;F++){if(F==B){D[K.yearText]={};for(var I=K.startYear;I<=K.endYear;I++){D[K.yearText][I]=I.toString().substr(2,2)}}else{if(F==m){D[K.monthText]={};for(var I=0;I<12;I++){D[K.monthText][I]=(I<9)?("0"+(I+1)):(I+1)}}else{if(F==z){D[K.dayText]={};for(var I=1;I<32;I++){D[K.dayText][I]=(I<10)?("0"+I):I}}}}}K.wheels.push(D)}if(K.preset.match(/time/i)){K.stepHour=(K.stepHour<1)?1:parseInt(K.stepHour);K.stepMinute=(K.stepMinute<1)?1:parseInt(K.stepMinute);K.stepSecond=(K.stepSecond<1)?1:parseInt(K.stepSecond);var D={};D[K.hourText]={};for(var I=1;I<(K.ampm?13:24);I+=K.stepHour){D[K.hourText][I]=(I<10)?("0"+I):I}D[K.minuteText]={};for(var I=0;I<60;I+=K.stepMinute){D[K.minuteText][I]=(I<10)?("0"+I):I}if(K.seconds){D[K.secText]={};for(var I=0;I<60;I+=K.stepSecond){D[K.secText][I]=(I<10)?("0"+I):I}}if(K.ampm){D[K.ampmText]={};D[K.ampmText]["AM"]="AM";D[K.ampmText]["PM"]="PM"}K.wheels.push(D)}}b(".dwc",x).remove();for(var I=0;I<K.wheels.length;I++){var E=b('<div class="dwc"><div class="dwwc"><div class="clear" style="clear:both;"></div></div>').insertBefore(b(".dwbc",x));for(var H in K.wheels[I]){var J=b(".dwwc .clear",E);var D=b('<div class="dwwl"><div class="dwl">'+H+'</div><div class="dww"><ul></ul><div class="dwwo"></div></div><div class="dwwol"></div></div>').insertBefore(J);for(var G in K.wheels[I][H]){b('<li class="val_'+G+'">'+K.wheels[I][H][G]+"</li>").data("val",G).appendTo(b("ul",D))}}}b(".dww ul",x).each(function(M){var L=b("li",this).index(b("li.val_"+A.temp[M],this));while((L<0)&&(--A.temp[M]>=0)){L=b("li",this).index(b("li.val_"+A.temp[M],this))}var N=r*(n-(L<0?0:L)-1);b(this).css("top",N)});b(".dwv",x).html(this.formatResult());b("#dw_set",x).text(K.setText).unbind().click(function(){A.setValue();K.onSelect(A.val,a);A.hide();return false});b("#dw_cancel",x).text(K.cancelText).unbind().click(function(){A.hide();return false});b(":input:disabled").addClass("dwtd");b(":input").attr("disabled",true);i.show();x.attr("class","dw "+K.theme).show();h=true;b(".dww, .dwwl",x).height(K.rows*r);b(".dww",x).each(function(){b(this).width(b(this).parent().width()<K.width?K.width:b(this).parent().width())});b(".dwbc a",x).attr("class",K.btnClass);b(".dww li",x).css({height:r,lineHeight:r+"px"});b(".dwwc",x).each(function(){var L=0;b(".dwwl",this).each(function(){L+=b(this).outerWidth(true)});b(this).width(L)});b(".dwc",x).each(function(){b(this).width(b(".dwwc",this).outerWidth(true))});this.pos();b(window).bind("resize.dw",function(){A.pos()})};this.pos=function(){var D=0;var G=0;var J=b(window).width();var F=b(window).height();var H=b(window).scrollTop();var E;var I;b(".dwc",x).each(function(){E=b(this).outerWidth(true);D+=E;G=(E>G)?E:G});E=D>J?G:D;x.width(E);E=x.outerWidth();I=x.outerHeight();x.css({left:(J-E)/2,top:H+(F-I)/2});i.height(0);i.height(b(document).height())};this.init=function(){var F=this.settings;var D=F.dateOrder.search(/y/i);var E=F.dateOrder.search(/m/i);var G=F.dateOrder.search(/d/i);B=(D<E)?(D<G?0:1):(D<G?1:2);m=(E<D)?(E<G?0:1):(E<G?1:2);z=(G<D)?(G<E?0:1):(G<E?1:2);this.preset=(F.wheels===null);if(this.values!==null){this.temp=this.values.slice(0)}else{this.temp=this.parseValue(b(C).val()?b(C).val():"");this.setValue(false)}};this.init();b(C).is("input")?b(C).attr("readonly","readonly").data("readonly",b(C).attr("readonly")):false;b(C).addClass("scroller").unbind("focus.dw").bind("focus.dw",function(){if(!A.settings.disabled&&A.settings.showOnFocus&&!h){A.show()}})}var j;var i;var r;var n;var a;var g={};var v=new Date();var q=v.getTime();var l=false;var w=null;var c;var o;var d;var e=("ontouchstart" in window);var p=e?"touchstart":"mousedown";var u=e?"touchmove":"mousemove";var k=e?"touchend":"mouseup";var f={width:60,height:40,rows:3,fx:false,disabled:false,showOnFocus:true,wheels:null,theme:"",preset:"date",dateFormat:"mm/dd/yy",dateOrder:"mdy",ampm:true,seconds:false,timeFormat:"hh:ii A",startYear:v.getFullYear()-10,endYear:v.getFullYear()+10,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortYearCutoff:"+10",monthText:"Month",dayText:"Day",yearText:"Year",hourText:"Hours",minuteText:"Minutes",secText:"Seconds",ampmText:"&nbsp;",setText:"Set",cancelText:"Cancel",btnClass:"dwb",stepHour:1,stepMinute:1,stepSecond:1,beforeShow:function(){},onClose:function(){},onSelect:function(){},formatResult:function(x){var h="";for(var m=0;m<x.length;m++){h+=(m>0?" ":"")+x[m]}return h},parseValue:function(h){return h.split(" ")}};var t={init:function(m){var x=b.extend({},f,m);if(b(".dwo").length){i=b(".dwo");j=b(".dw")}else{i=b('<div class="dwo"></div>').hide().appendTo("body");j=b('<div class="dw"><div class="dwv">&nbsp;</div><div class="dwbc" style="clear:both;"><a id="dw_set" href="#"></a><a id="dw_cancel" href="#"></a></div></div>');j.hide().appendTo("body");b(document).bind(u,function(y){if(l){o=e?y.originalEvent.changedTouches[0].pageY:y.pageY;w.css("top",(d+o-c)+"px");y.preventDefault();y.stopPropagation();return false}});function h(z,A){A=A>((n-1)*r)?((n-1)*r):A;A=A<(n*r-b("li:visible",z).length*r)?(n*r-b("li:visible",z).length*r):A;if(a.settings.fx){z.stop(true,true).animate({top:A+"px"},"fast")}else{z.css("top",A)}var y=b("ul",j).index(z);a.temp[y]=b("li:eq("+(n-1-A/r)+")",z).data("val");a.validate(y);b(".dwv",j).html(a.formatResult())}b(document).bind(k,function(y){if(l){var z=Math.round((d+o-c)/r)*r;z=z>((n-1)*r)?((n-1)*r):z;z=z<(n*r-b("li:visible",w).length*r)?(n*r-b("li:visible",w).length*r):z;h(w,z);l=false;w=null;y.preventDefault();y.stopPropagation()}});b(".dwwl").live("DOMMouseScroll mousewheel",function(A){var C=0;if(A.wheelDelta){C=A.wheelDelta/120}if(A.detail){C=-A.detail/3}var y=b("ul",this);var z=y.css("top").replace(/px/i,"")-0;var B=Math.round((z+C*r)/r)*r;h(y,B);A.preventDefault();A.stopPropagation()});b(".dwwl").live(p,function(A){if(!l){var z=e?A.originalEvent.changedTouches[0].pageX:A.pageX;var y=b(this).offset().left;l=true;w=b("ul",this);d=w.css("top").replace(/px/i,"")-0;c=e?A.originalEvent.changedTouches[0].pageY:A.pageY;o=c;A.preventDefault();A.stopPropagation()}})}return this.each(function(){if(!this.id){q+=1;this.id="scoller"+q}g[this.id]=new s(this,j,x)})},validate:function(){},enable:function(){return this.each(function(){if(g[this.id]){g[this.id].settings.disabled=false}})},disable:function(){return this.each(function(){if(g[this.id]){g[this.id].settings.disabled=true}})},isDisabled:function(){if(g[this[0].id]){return g[this[0].id].settings.disabled}},option:function(h,m){return this.each(function(){if(g[this.id]){if(typeof h==="object"){b.extend(g[this.id].settings,h)}else{g[this.id].settings[h]=m}g[this.id].init()}})},setValue:function(m,h){if(h==undefined){h=false}return this.each(function(){if(g[this.id]){g[this.id].temp=m;g[this.id].setValue(m,h)}})},getValue:function(){if(g[this[0].id]){return g[this[0].id].values}},setDate:function(m,h){if(h==undefined){h=false}return this.each(function(){if(g[this.id]){g[this.id].setDate(m,h)}})},getDate:function(){if(g[this[0].id]){return g[this[0].id].getDate()}},show:function(){if(g[this[0].id]){return g[this[0].id].show()}},hide:function(){return this.each(function(){if(g[this.id]){g[this.id].hide()}})},destroy:function(){return this.each(function(){if(g[this.id]){b(this).unbind("focus.dw").removeClass("scroller");b(this).is("input")?b(this).attr("readonly",b(this).data("readonly")):false;delete g[this.id]}})}};b.fn.scroller=function(h){if(t[h]){return t[h].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof h==="object"||!h){return t.init.apply(this,arguments)}else{b.error("Unknown method")}}};b.scroller=new s(null,null,f)})(jQuery);
